<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>QGæŠ€æœ¯è®ºå›</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="homepage.css"/>
    <link rel="stylesheet" href="message.css"/>
    <link rel="stylesheet" href="myself.css"/>
    <link rel="stylesheet" href="board.css"/>
    <link rel="stylesheet" href="post.css"/>
    <!-- å¼•å…¥ä»£ç é«˜äº®åº“ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github.min.css">
    <!-- åŠ è½½ marked -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
<div id="app">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="top-bar">
        <div class="current-location">
            {{ currentPath.join(' > ') }}
        </div>
    </div>

    <!-- å·¦ä¾§åŠŸèƒ½å¯¼èˆª -->
    <div class="left-column">
        <h2 style="text-align: center;">â€”â€”åŠŸèƒ½å¯¼èˆªâ€”â€”</h2>
        <hr>
        <div class="nav-item" @click="backHomePage">ğŸ  å›åˆ°ä¸»é¡µ</div>
        <div class="nav-item" @click="turnAllBoard">ğŸ§© å…¨éƒ¨ç‰ˆå—</div>
        <div class="nav-item" @click="turnAllBoardApply">ğŸ”” åˆ›å»ºç‰ˆå—ç”³è¯·
            <div v-if="ifHadNewMessage" class="notification-badge"></div>
        </div>
        <hr>
        <div class="nav-item" @click="exitLogin">ğŸšª é€€å‡ºç™»å½•</div>
    </div>

    <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
    <div class="right-column">

        <!-- ä¸»é¡µå†…å®¹ -->
        <div v-if="ifHomePage" class="content-section">
            <h3>ğŸ“Œ æœ€æ–°å…¬å‘Š</h3>
            <p>æ¬¢è¿æ¥åˆ°QGæŠ€æœ¯è®ºå›ï¼è¿™é‡Œæœ‰æœ€æ–°æŠ€æœ¯åŠ¨æ€å’Œæ·±åº¦è®¨è®ºã€‚</p>
        </div>

        <!-- ç‰ˆå—å…¬å‘Šå†…å®¹ -->
        <div class="content-section" v-if="ifBoardNotice">
            <h3>ğŸ“Œ å…¬å‘Š
                <button @click="showHistoryModal = true" class="history-btn">æŸ¥çœ‹å†å²å…¬å‘Š</button>
            </h3>
            <p class="notice-content">{{ currentNotice.content }}</p>
            <p class="notice-time">ğŸ“… å‘å¸ƒæ—¶é—´ï¼š{{ currentNotice.time }}</p>
            <!-- å†å²å…¬å‘Šå¼¹çª— -->
            <div v-if="showHistoryModal" class="modal">
                <!--ç‚¹å‡»å¤–ä¾§åŒºåŸŸå…³é—­å¼¹çª—-->
                <div v-if="showHistoryModal" class="modal" @click.self="showHistoryModal = false">
                    <div class="modal-content">
                        <h3>å†å²å…¬å‘Šï¼ˆç‚¹å‡»å¼¹çª—å¤–åŒºåŸŸä»¥å…³é—­ï¼‰</h3>
                        <div class="history-notice-list">
                            <div v-for="(eachNotice, index) in notice"
                                 @click="switchNotice(index)"> <!-- ç‚¹å‡»åˆ‡æ¢ -->
                                <span>ğŸ“… {{ eachNotice.time }}</span>
                                <p>{{ eachNotice.content }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å…¨éƒ¨ç‰ˆå— -->
        <div v-if="ifAllBoard" class="profile-section">
            <div class="board-list" v-if="!ifAllPostInThisBoard">
                <div class="search-bar">
                    <input type="text" v-model="boardSearchQuery"
                           placeholder="è¾“å…¥ç‰ˆä¸»æ˜µç§°æˆ–ç‰ˆå—åç§°ä»¥æœç´¢"
                           @input="searchBoard">
                </div>
                <div class="filter-buttons">
                    <button @click="fetchNewBoard" class="filter-btn">æœ€æ–°ç‰ˆå—</button>
                    <button @click="fetchHotBoard" class="filter-btn">æœ€çƒ­é—¨ç‰ˆå—</button>
                </div>
                <div v-for="board in allBoard" :key="board.id" class="board-item">
                    <div class="board-info" @click="turnAllPostInThisBoard(board.id, board.title)">
                        <img :src="board.hostAvatar" class="host-avatar">
                        <h4>id: {{ board.id }} | {{ board.title }}</h4>
                        <p>ç±»å‹: {{ board.type }} | å¸–å­æ•°: {{ board.postCount }} | æµè§ˆæ•°: {{ board.viewCount }}</p>
                        <p>ç‰ˆä¸»: {{ board.hostName }} | ç‰ˆä¸»id: {{ board.hostId }} | åˆ›å»ºæ—¶é—´ï¼š{{ board.time }}</p>
                    </div>
                </div>
            </div>
            <div class="post-list" v-if="ifAllPostInThisBoard">
                <div class="search-bar">
                    <input type="text" v-model="postSearchQuery"
                           placeholder="è¾“å…¥å‘å¸–ç”¨æˆ·æ˜µç§°æˆ–å¸–å­åç§°ä»¥æœç´¢"
                           @input="searchPost">
                </div>
                <!--æ¸²æŸ“å…¨éƒ¨å¸–å­ä¿¡æ¯ï¼Œç‚¹å‡»å¸–å­åˆ‡æ¢åˆ°å¯¹åº”å¸–å­å†…å®¹-->
                <div v-for="post in allPostInThisBoard"
                     v-if="post.title && post.title.trim()!== ''"
                     :key="post.id"
                     class="post-card"
                     @click="turnThisPost(post.id, post.title)">
                    <!--æ˜¾ç¤ºå¸–å­ä¿¡æ¯-->
                    <div class="post-meta">
                        <img :src="post.authorAvatar" class="author-avatar">
                        <span class="author">ğŸ‘¤ {{ post.authorName }} | ç”¨æˆ·id: {{ post.authorId }} </span>
                        <span class="time">ğŸ“… {{ post.time }}</span>
                    </div>
                    <h4 class="post-title">å¸–å­id: {{ post.id }} | {{ post.title }}</h4>
                    <div class="post-stats">
                        <span>â¤ï¸ {{ post.likeCount }}</span>
                        <span>ğŸ’¬ {{ post.commentCount }}</span>
                        <span>ğŸ‘€ {{ post.viewCount }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¸–å­å…·ä½“å†…å®¹ -->
        <div v-if="ifThisPost" class="post-detail-section">
            <!-- å¸–å­æ ‡é¢˜å’Œå…ƒä¿¡æ¯ -->
            <div class="post-header">
                <h2 class="post-title">å¸–å­id: {{ thisPost.id }} | {{ thisPost.title }}</h2>
                <div class="post-meta">
                    <img :src="thisPost.authorAvatar" class="author-avatar">
                    <span class="author">ğŸ‘¤ {{ thisPost.authorName }} | ç”¨æˆ·id: {{ thisPost.authorId }} </span>
                    <span class="time">ğŸ“… {{ thisPost.time }}</span>
                    <span class="views">ğŸ‘€ {{ thisPost.viewCount }} æµè§ˆ</span>
                    <span class="likes">â¤ï¸ {{ thisPost.likeCount }} ç‚¹èµ</span>
                </div>
            </div>

            <!-- æ°´å¹³åˆ†å‰²çº¿ -->
            <hr class="post-divider">

            <!-- å¸–å­å†…å®¹(Markdownæ¸²æŸ“åŒºåŸŸ) -->
            <div class="post-content markdown-body" v-html="compiledMarkdown"></div>

            <!-- æ°´å¹³åˆ†å‰²çº¿ -->
            <hr class="post-divider">

            <!-- è¯„è®ºåŒºåŸŸ -->
            <div class="comment-section">
                <h3>è¯„è®º ({{ thisPost.commentCount }})</h3>


                <!-- è¯„è®ºåˆ—è¡¨ -->
                <div class="comment-list">
                    <div v-for="comment in allCommentInThisPost" :key="comment.id" class="comment-item">
                        <div class="comment-header">
                            <img :src="comment.userAvatar" class="comment-avatar">
                            <span class="comment-author">{{ comment.userName }}</span>
                            <span class="comment-time">{{ formatTime(comment.time) }}</span>
                        </div>
                        <div class="comment-content" v-html="renderMarkdown(comment.content)"></div>

                        <!-- å­è¯„è®ºåŒºåŸŸï¼šä½¿ç”¨é€’å½’ç»„ä»¶ -->
                        <div class="child-comments">
                            <comment-tree
                                    :comments="comment.childComment"
                                    :parent-name="comment.userName"
                                    :format-time="formatTime"
                                    :render-markdown="renderMarkdown"
                            ></comment-tree>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- æŸ¥çœ‹æ‰€æœ‰ç‰ˆå—ç”³è¯· -->
        <div v-if="ifAllBoardApply" class="board-section">
            <h2>å®¡æ ¸ï¼šç”¨æˆ·ç”³è¯·åˆ›å»ºç‰ˆå—</h2>
            <button @click="deleteAllDealApply" class="delete-post-btn">
                åˆ é™¤æ‰€æœ‰å·²å¤„ç†çš„ç”³è¯·
            </button>
            <hr>
            <br>
            <div class="post-list">
                <!--æ¸²æŸ“ç”³è¯·ä¿¡æ¯-->
                <div v-for="apply in allBoardApply"
                     :key="apply.id"
                     class="post-card">
                    <span v-if="!apply.ifDeal" class="notification-badge"></span>
                    <div>
                        <div class="post-meta">
                            <img :src="apply.hostAvatar" class="author-avatar">
                            <span class="author">ğŸ‘¤ {{ apply.hostName }}
                                | ç”¨æˆ·uidï¼š{{ apply.hostId }}
                                | ç”¨æˆ·ç­‰çº§ï¼š{{ apply.grade }}</span>
                            <span class="time">ğŸ“… {{ apply.time }}</span>
                        </div>
                        <h4 class="post-title">ç‰ˆå—ç±»å‹ï¼š {{ apply.type }}</h4>
                        <div class="post-stats">
                            <span>ç”³è¯·ç†ç”±ï¼š{{ apply.notice }}</span>
                        </div>
                    </div>
                    <div class="board-actions">
                        <button v-if="!apply.ifDeal"
                                @click="agreeThisApply(apply)"
                                class="follow-btn">åŒæ„ç”³è¯·
                        </button>
                        <button v-if="!apply.ifDeal"
                                @click="refuseThisApply(apply)"
                                class="delete-post-btn">æ‹’ç»ç”³è¯·
                        </button>
                    </div>
                </div>
            </div>
        </div>


    </div>

</div>

<!--åŠ è½½axios-->
<script src="https://cdn.bootcdn.net/ajax/libs/axios/1.6.7/axios.min.js"></script>
<!--åŠ è½½vue-->
<script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.14/vue.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/c.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js"></script>

<script>
    hljs.configure({
        ignoreUnescapedHTML: true
    });
    hljs.highlightAll();
</script>

<!--å¾ªç¯æ¸²æŸ“è¯„è®ºçš„ç»„ä»¶æ³¨å†Œ-->
<script>
    Vue.component('comment-tree', {
        // å®šä¹‰ç»„ä»¶æ¥æ”¶çš„å±æ€§
        props: [
            'comments',
            'parentName',
            'formatTime',
            'renderMarkdown',

        ],
        // å®šä¹‰ç»„ä»¶çš„æ¨¡æ¿
        template: `
          <div>
            <div v-for="child in comments" :key="child.id" class="child-comment">
              <div class="comment-header">
                <img :src="child.userAvatar" class="comment-avatar">
                <span class="comment-author">{{ child.userName }}</span>
                <!-- ä½¿ç”¨propsä¼ é€’çš„æ–¹æ³• -->
                <span class="comment-time">{{ formatTime(child.time) }}</span>
              </div>
              <!-- ä½¿ç”¨propsä¼ é€’çš„æ–¹æ³• -->
              <div class="comment-content" v-html="renderMarkdown('å›å¤ @' + parentName + 'ï¼š' + child.content)"></div>
              <!-- é€’å½’æ—¶ç»§ç»­ä¼ é€’æ–¹æ³•ï¼Œé€’å½’æ¸²æŸ“å­è¯„è®º -->
              <comment-tree
                  v-if="child.childComment && child.childComment.length"
                  :comments="child.childComment"
                  :parent-name="child.userName"
                  :format-time="formatTime"
                  :render-markdown="renderMarkdown"
              ></comment-tree>
            </div>
          </div>
        `
    });
</script>

<script>
    new Vue({
        el: '#app',
        data: {
            ifHomePage: true,                   // æ˜¾ç¤ºä¸»é¡µ
            ifAllBoard: false,                  // æ˜¾ç¤ºæ‰€æœ‰ç‰ˆå—
            ifAllPostInThisBoard: false,        // æ˜¾ç¤ºè¯¥ç‰ˆå—æ‰€æœ‰å¸–å­
            ifAllPostInMyBoard: false,          // æ˜¾ç¤ºæˆ‘çš„ç‰ˆå—çš„æ‰€æœ‰å¸–å­
            ifThisPost: false,                  // æ˜¾ç¤ºè¯¥å¸–å­
            ifBoardNotice: false,               // æ˜¾ç¤ºç‰ˆå—å…¬å‘Š
            ifHadNewMessage: false,             // æ§åˆ¶çº¢ç‚¹æ˜¾ç¤º
            ifAllBoardApply: false,                 // æ˜¯å¦æ˜¾ç¤ºæˆ‘çš„é€šçŸ¥ä¿¡æ¯


            showHistoryModal: false,            // æ˜¯å¦æ˜¾ç¤ºå†å²å…¬å‘Šå¼¹çª—
            currentBoardId: null,
            allBoard: [],
            allPostInThisBoard: [],

            boardSearchQuery: '',               // ç‰ˆå—å…³é”®å­—æœç´¢
            originalAllBoard: [],
            postSearchQuery: '',                // å¸–å­å…³é”®å­—æœç´¢
            originalAllPostInThisBoard: [],
            originalAllPostInMyBoard: [],

            notice: [],                         // å­˜å‚¨æ‰€æœ‰å…¬å‘Š
            currentNotice: {                    // å½“å‰å±•ç¤ºçš„å…¬å‘Š
                time: '',
                content: 'å½“å‰æš‚æ— å…¬å‘Š',
            },
            currentPath: ['QGæŠ€æœ¯è®ºå›', 'ä¸»é¡µ'],
            avatar: '/images/avatar/initAvatar.jpg',

            thisPost: {},                       // è®¿é—®æŸä¸ªå¸–å­
            allCommentInThisPost: [],           // è¯¥å¸–å­ä¸‹çš„æ‰€æœ‰è¯„è®º
            compiledMarkdown: '',               // å¸–å­å†…å®¹
            markdownText: '',                   // å‘å¸ƒå¸–å­å†…å®¹
            newPostTitle: '',

            currentCommentId: '',               // å½“å‰è¯„è®ºçš„id
            allBoardApply: [],                      // æˆ‘çš„é€šçŸ¥æ¶ˆæ¯
            allReportPostToMe: [],              // å‘æˆ‘ä¸¾æŠ¥çš„ä¿¡æ¯
        },
        mounted() {

            // ç¡®ä¿åº“å·²åŠ è½½
            if (typeof hljs === 'undefined' || typeof marked === 'undefined') {
                console.error('åº“åŠ è½½å¤±è´¥!');
                return;
            }

            // é…ç½®marked
            marked.setOptions({
                breaks: true,
                highlight: function (code, lang) {
                    if (lang && hljs.getLanguage(lang)) {
                        try {
                            return hljs.highlight(code, {language: lang}).value;
                        } catch (e) {
                            console.warn(`Failed to highlight ${lang} code:`, e);
                        }
                    }
                    return hljs.highlightAuto(code).value;
                }
            });

            // åˆå§‹é«˜äº®
            this.highlightAll();

            this.turnNothing();
            this.ifHomePage = true;
        },
        methods: {
            // åŒæ„ç‰ˆå—ç”³è¯·
            agreeThisApply(apply) {
                axios.post('/board/agreeThisApply', {
                    applyId: apply.id,
                }, {
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                }).then(response => {
                    if (response.data.code === 200) {
                        console.log(response.data);
                        alert('åŒæ„åˆ›å»º');
                        apply.ifDeal = true;
                        this.turnAllBoardApply();
                    } else {
                        alert(response.data.message);
                        console.error(response.data.code + ' ' + response.data.message);
                    }
                });
            },
            // æ‹’ç»ç‰ˆå—ç”³è¯·
            refuseThisApply(apply) {
                axios.post('/board/refuseThisApply', {
                    applyId: apply.id,
                }, {
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                }).then(response => {
                    if (response.data.code === 200) {
                        console.log(response.data);
                        alert('æ‹’ç»ç”³è¯·');
                        apply.ifDeal = true;
                        this.turnAllBoardApply();
                    } else {
                        alert(response.data.message);
                        console.error(response.data.code + ' ' + response.data.message);
                    }
                });
            },
            // æ¸…ç©ºæ‰€æœ‰å·²å¤„ç†çš„ä¸¾æŠ¥
            deleteAllDealReport() {
                axios.post('/report/deleteAllDealReport', {
                    boardId: this.currentBoardId,
                }, {
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                }).then(response => {
                    if (response.data.code === 200) {
                        console.log(response.data);
                        alert('æ¸…ç©ºæ‰€æœ‰å·²å¤„ç†çš„ä¸¾æŠ¥');
                        this.turnReportPostToMe();
                    } else {
                        alert(response.data.message);
                        console.error(response.data.code + ' ' + response.data.message);
                    }
                });
            },
            // æ‹’ç»å¤„ç†ä¸¾æŠ¥
            refuseThisReport(reportId) {
                axios.post('/report/refuseThisReport', {
                    reportId: reportId,
                }, {
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                }).then(response => {
                    if (response.data.code === 200) {
                        console.log(response.data);
                        alert('å·²æ‹’ç»å¤„ç†');
                        this.turnReportPostToMe();
                    } else {
                        alert(response.data.message);
                        console.error(response.data.code + ' ' + response.data.message);
                    }
                });
            },
            // ç¡®è®¤å¤„ç†ä¸¾æŠ¥
            dealThisReport(reportId) {
                axios.post('/report/dealThisReport', {
                    reportId: reportId,
                }, {
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                }).then(response => {
                    if (response.data.code === 200) {
                        console.log(response.data);
                        alert('å·²ç¡®è®¤å¤„ç†');
                        this.turnReportPostToMe();
                    } else {
                        alert(response.data.message);
                        console.error(response.data.code + ' ' + response.data.message);
                    }
                });
            },
            // æ˜¾ç¤ºç”¨æˆ·ä¸¾æŠ¥ç»™ç‰ˆä¸»çš„æ‰€æœ‰ä¿¡æ¯
            turnReportPostToMe() {
                this.ifMyBoard = true;
                this.ifAllPostInMyBoard = false;
                this.ifReportPostToMe = true;
                this.fetchReportPostToMe();
            },
            // è·å–ç”¨æˆ·ä¸¾æŠ¥ç»™ç‰ˆä¸»çš„æ‰€æœ‰ä¿¡æ¯
            fetchReportPostToMe() {
                axios.post('/report/getReportPostToMe', {
                    boardId: this.currentBoardId,
                }, {
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                })
                    .then(response => {
                        if (response.data.code === 200) {
                            this.allReportPostToMe = response.data.data;
                        } else {
                            console.error('è·å–æˆ‘çš„ç‰ˆå—ä¸‹çš„ä¸¾æŠ¥ä¿¡æ¯å¤±è´¥:', response.data.message);
                        }
                    })
            },
            // åˆ é™¤æ‰€æœ‰å·²è¯»ä¿¡æ¯
            deleteAllDealApply() {
                axios.post('/board/deleteAllDealApply')
                    .then(response => {
                        if (response.data.code === 200) {
                            alert(response.data.message);
                        } else {
                            console.error('æ¸…é™¤æ‰€æœ‰å·²å¤„ç†ç‰ˆå—å¤±è´¥:', response.data.message);
                        }
                    });
                this.turnMyMessage();
            },
            // æŸ¥çœ‹æˆ‘æ˜¯å¦æœ‰æ–°çš„é€šçŸ¥æ¶ˆæ¯
            async checkIfNewBoardApply() {
                try {
                    const response = await axios.post('/board/checkIfNewBoardApply');
                    return response.data.data === "yes";
                } catch (error) {
                    console.error('æŸ¥çœ‹æ˜¯å¦æœ‰æ–°çš„é€šçŸ¥æ¶ˆæ¯å¤±è´¥:', error);
                    return false;
                }
            },
            // å…¨éƒ½ä¸æ˜¾ç¤º
            turnNothing() {
                this.ifBoardNotice = false;
                this.ifHomePage = false;
                this.ifAllBoard = false;
                this.ifAllPostInMyBoard = false;
                this.ifThisPost = false;
                this.ifAllBoard = false;
                this.ifAllPostInThisBoard = false;
                this.checkIfNewBoardApply().then(isCollected => {
                    this.ifHadNewMessage = isCollected;
                });
            },
            // åˆ‡æ¢æ‰€æœ‰ç‰ˆå—çš„ç”³è¯·
            turnAllBoardApply() {
                this.turnNothing();
                this.ifAllBoardApply = true;
                this.fetchAllBoardApply();
                this.currentPath = ['QGæŠ€æœ¯è®ºå›', 'å®¡æ ¸ç‰ˆå—ç”³è¯·'];
            },
            // è·å–æ‰€æœ‰ç‰ˆå—ç”³è¯·
            fetchAllBoardApply() {
                axios.post('/board/getAllApplyNewBoard')
                    .then(response => {
                        if (response.data.code === 200) {
                            this.allBoardApply = response.data.data;
                        } else {
                            console.error('è·å–æˆ‘çš„é€šçŸ¥æ¶ˆæ¯:', response.data.message);
                        }
                    })
                    .catch(error => {
                        console.error('è¯·æ±‚é”™è¯¯:', error);
                    });
            },
            // æ—¶é—´æ ¼å¼åŒ–
            formatTime(time) {
                return new Date(time).toLocaleString();
            },
            // è·å–è¯¥å¸–å­çš„æ‰€æœ‰è¯„è®º
            fetchComment(post_id) {
                axios.post('/comment/getAllCommentInThisPost', new URLSearchParams({
                    postId: post_id,
                }), {
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                }).then(response => {
                    if (response.data.code === 200) {
                        this.allCommentInThisPost = response.data.data;
                    }
                }).catch(error => {
                    console.error("è·å–è¯„è®ºå¤±è´¥", error);
                });
            },
            // æ¸²æŸ“ Markdown å†…å®¹
            renderMarkdown(content) {
                if (typeof marked === 'undefined') {
                    console.error('marked is not available');
                    return content;
                }
                const html = marked.parse(content || '');
                this.$nextTick(() => {
                    // æ¸²æŸ“åé‡æ–°é«˜äº®
                    this.highlightAll();
                });
                return html;
            },
            // é«˜äº®æ‰€æœ‰ä»£ç å—
            highlightAll() {
                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            },
            // æ˜¾ç¤ºæŸä¸ªå…·ä½“å¸–å­
            turnThisPost(post_id, post_title) {
                this.turnNothing();
                this.ifThisPost = true;
                this.fetchThisPost(post_id, post_title);        // æŠ“å–è¿™ä¸ªå¸–å­çš„ä¿¡æ¯
                this.fetchComment(post_id);                     // æŠ“å–æ‰€æœ‰è¯„è®º

            },
            // è·å–å…¬å‘Š
            fetchNotice(board_id) {
                axios.post('/board/getNotice', new URLSearchParams({
                    boardId: board_id,
                }), {
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                }).then(response => {
                    if (response.data.code === 200) {
                        this.notice = response.data.data;
                        // é»˜è®¤æ˜¾ç¤ºæœ€æ–°å…¬å‘Š
                        if (this.notice.length > 0) {
                            this.currentNotice = this.notice[0];
                        }
                    }
                })
                    .catch(error => {
                        console.error('è·å–å…¬å‘Šå¤±è´¥:', error);
                    });
            },
            // åˆ‡æ¢å…¬å‘Š
            switchNotice(index) {
                this.currentNotice = this.notice[index];
                this.showHistoryModal = false; // ç‚¹å‡»åå…³é—­å¼¹çª—
            },
            // å…¨éƒ¨ç‰ˆå—ä¸­ï¼Œå¸–å­å…³é”®å­—æœç´¢ç‰ˆå—
            searchPost() {
                if (this.postSearchQuery.trim() === '') {
                    // æ¸…ç©ºæœç´¢æ—¶æ¢å¤åŸå§‹æ•°æ®
                    this.allPostInThisBoard = this.originalAllPostInThisBoard;
                    return;
                }

                // å°†æŸ¥è¯¢çš„å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå°å†™
                const query = this.postSearchQuery.toLowerCase();
                this.allPostInThisBoard = this.originalAllPostInThisBoard.filter(post =>
                    // å°†åç§°è½¬åŒ–ä¸ºå°å†™ï¼Œå¦‚æœåŒ…å«ä½œè€…åç§°æˆ–æ ‡é¢˜ï¼Œåˆ™å‚¨å­˜
                    post.authorName.toLowerCase().includes(query) ||
                    post.title.toLowerCase().includes(query))
            },
            // ç‰ˆå—å…³é”®å­—æœç´¢ç‰ˆå—
            searchBoard() {
                if (this.boardSearchQuery.trim() === '') {
                    // æ¸…ç©ºæœç´¢æ—¶æ¢å¤åŸå§‹æ•°æ®
                    this.allBoard = this.originalAllBoard;
                    return;
                }

                // å°†æŸ¥è¯¢çš„å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå°å†™
                const query = this.boardSearchQuery.toLowerCase();
                this.allBoard = this.originalAllBoard.filter(board =>
                    // å°†è¯¾ç¨‹åç§°è½¬åŒ–ä¸ºå°å†™ï¼Œå¦‚æœåŒ…å«è¿™ä¸ªè¯¾ç¨‹åç§°ï¼Œåˆ™å‚¨å­˜
                    board.hostName.toLowerCase().includes(query) ||
                    board.title.toLowerCase().includes(query))
            },
            // åˆ‡æ¢å›ä¸»é¡µ
            backHomePage() {
                this.turnNothing();
                this.ifHomePage = true;
                this.currentPath = ['QGæŠ€æœ¯è®ºå›', 'ä¸»é¡µ'];
            },
            // åˆ‡æ¢è¯¥ç‰ˆå—ä¸‹æ‰€æœ‰å¸–å­
            turnAllPostInThisBoard(board_id, board_title) {
                this.turnNothing();
                this.ifAllBoard = true;
                this.ifAllPostInThisBoard = true;
                this.currentBoardId = board_id;
                this.fetchAllPostInThisBoard(board_id, board_title);
                this.currentBoardId = board_id;
                this.fetchNotice(board_id);
            },
            // åˆ‡æ¢æ‰€æœ‰ç‰ˆå—
            turnAllBoard() {
                this.turnNothing();
                this.ifAllBoard = true;
                this.fetchAllBoard();
                this.currentPath = ['QGæŠ€æœ¯è®ºå›', 'æ‰€æœ‰ç‰ˆå—'];
            },
            // è·å–å…¨éƒ¨ç‰ˆå—
            fetchAllBoard() {
                axios.post('/board/getAllBoardOrderById')
                    .then(response => {
                        if (response.data.code === 200) {
                            this.allBoard = response.data.data;
                            this.originalAllBoard = this.allBoard;
                        }
                    })
                    .catch(error => {
                        console.error('è·å–ç‰ˆå—å¤±è´¥:', error);
                    });
            },
            // è·å–çƒ­é—¨ç‰ˆå—
            fetchHotBoard() {
                axios.post('/board/getHotBoard')
                    .then(response => {
                        if (response.data.code === 200) {
                            this.allBoard = response.data.data;
                            this.originalAllBoard = this.allBoard;
                        }
                    })
                    .catch(error => {
                        console.error('è·å–ç‰ˆå—å¤±è´¥:', error);
                    });
            },
            // è·å–æœ€æ–°ç‰ˆå—
            fetchNewBoard() {
                axios.post('/board/getNewBoard')
                    .then(response => {
                        if (response.data.code === 200) {
                            this.allBoard = response.data.data;
                            this.originalAllBoard = this.allBoard;
                        }
                    })
                    .catch(error => {
                        console.error('è·å–ç‰ˆå—å¤±è´¥:', error);
                    });
            },
            // è·å–è¯¥ç‰ˆå—ä¸‹çš„æ‰€æœ‰å¸–å­
            fetchAllPostInThisBoard(board_id, board_title) {
                axios.post('/post/getAllPostInThisBoardOrderByTimeDesc', new URLSearchParams({
                    boardId: board_id,
                }), {
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                }).then(response => {
                    if (response.data.code !== 200) {
                        alert(response.data.message);
                    } else {
                        this.allPostInThisBoard = response.data.data;
                        this.originalAllPostInThisBoard = this.allPostInThisBoard;
                        this.currentPath = ['QGæŠ€æœ¯è®ºå›', 'ç‰ˆå—ï¼š' + board_title, 'æ‰€æœ‰å¸–å­'];
                        console.log("è·å–ç‰ˆå—ï¼š" + board_title + "çš„æ‰€æœ‰å¸–å­æˆåŠŸ,å…±æœ‰" + this.allPostInThisBoard.length + "æ¡å¸–å­");
                    }
                })
                    .catch(error => {
                        console.error("è·å–ç‰ˆå—ï¼š" + board_title + "çš„æ‰€æœ‰å¸–å­å¤±è´¥", error);
                    });
            },
            // è·å–è¯¥å¸–å­çš„æ‰€æœ‰å†…å®¹
            fetchThisPost(post_id, post_title) {
                axios.post('/post/getThisPost', new URLSearchParams({
                    postId: post_id,
                }), {
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                }).then(response => {
                    if (response.data.code !== 200) {
                        alert(response.data.message);
                    } else {
                        this.thisPost = response.data.data;
                        // æ¸²æŸ“ Markdown å†…å®¹
                        this.compiledMarkdown = this.renderMarkdown(this.thisPost.content);
                        // æŠŠå½“å‰å¸–å­åŠ å…¥è·¯å¾„ä¸­æ˜¾ç¤ºåœ¨å·¦ä¸Šè§’
                        this.currentPath.push(post_title);
                        console.log("è·å–å¸–å­ï¼š" + post_title + "æˆåŠŸ");
                    }
                })
                    .catch(error => {
                        console.error("è·å–å¸–å­ï¼š" + post_title + "å¤±è´¥", error);
                    });
                // ç¡®ä¿å†…å®¹æ¸²æŸ“åé«˜äº®
                this.$nextTick(() => {
                    document.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                });
            },
            // é€€å‡ºç™»å½•
            exitLogin() {
                axios.post('/login/exitLogin');
                window.location.href = '/login.html';
            },
        }

    })
</script>
</body>
</html>